/*
BASE DE DATOS : BD_TASTY
AUTHOR : JOAQUIN CUNORANA JIMENEZ / GONZALO CAMACHO
DESCRIPCION : UNA BASE DE DATOS MODELADO PARA EL NEGOCIO DE FASTO FOOD 
*/

DROP DATABASE IF EXISTS BD_TASTY;
CREATE DATABASE BD_TASTY;
USE BD_TASTY;



CREATE TABLE TB_ROL(
ROL_ID INT AUTO_INCREMENT PRIMARY KEY,
ROL_NAM VARCHAR(40) NOT NULL,
ROL_EST CHAR(1) DEFAULT '1'
);

INSERT INTO TB_ROL VALUES(NULL,'ADMINISTRADOR',NULL);
INSERT INTO TB_ROL VALUES(NULL,'EMPLEADO',NULL);
INSERT INTO TB_ROL VALUES(NULL,'COCINERO',NULL);
INSERT INTO TB_ROL VALUES(NULL,'CAJERO',NULL);

CREATE TABLE TB_CATEGORIA_PRODUCTO(
CAT_PRO_ID INT AUTO_INCREMENT PRIMARY KEY,
CAT_PRO_NOM VARCHAR(70) NOT NULL,
CAT_PRO_DES VARCHAR(140) NOT NULL,
CAT_PRO_EST CHAR(1) DEFAULT '1'
);

CREATE TABLE TB_TIPO_DOCUMENTO(
TIP_DOC_ID INT AUTO_INCREMENT PRIMARY KEY,
TIP_DOC VARCHAR(120)
);

CREATE TABLE TB_CLIENTE(
CLI_ID INT AUTO_INCREMENT PRIMARY KEY ,
CLI_NOM VARCHAR(70) NOT NULL,
TIP_DOC_ID INT NOT NULL,
CLI_DOC_NUM INT NOT NULL,
CLI_APE VARCHAR(120) NOT NULL,
CLI_PUN INT DEFAULT 0,
CLI_TEL VARCHAR(12) NULL,
CLI_EST CHAR(1) DEFAULT '1',
CLI_MAIL VARCHAR(70) NULL,
AUD_TIPO CHAR(1) NULL,
AUD_IDUSUARIO INT NULL,
AUD_SESION VARCHAR(60) NULL,
AUD_FECHA DATE NULL,
AUD_IP VARCHAR(20) NULL,
FOREIGN KEY (TIP_DOC_ID) REFERENCES TB_TIPO_DOCUMENTO(TIP_DOC_ID)
);

CREATE TABLE TB_PROVEEDOR(
PROV_ID INT AUTO_INCREMENT PRIMARY KEY,
PROV_NOM VARCHAR(80) NOT NULL,
PROV_COD_RUC CHAR(11) NOT NULL,
PROV_NUM_TEL VARCHAR(12) NOT NULL,
PROV_ESTADO CHAR(1)DEFAULT '1' NOT NULL,
PROV_EST CHAR(1) DEFAULT '1',
AUD_TIPO CHAR(1) NULL,
AUD_IDUSUARIO INT NULL,
AUD_SESION VARCHAR(60) NULL,
AUD_FECHA DATE NULL,
AUD_IP VARCHAR(20) NULL 
);

CREATE TABLE TB_INSUMO(
INS_ID INT AUTO_INCREMENT PRIMARY KEY,
INS_NOM VARCHAR(70) NOT NULL,
INS_DES VARCHAR(150) NOT NULL,
INS_PRE NUMERIC(8,2) NOT NULL,
INS_EST CHAR(1)DEFAULT '1' ,
AUD_TIPO CHAR(1) NULL,
AUD_IDUSUARIO INT NULL,
AUD_SESION VARCHAR(60) NULL,
AUD_FECHA DATE NULL,
AUD_IP VARCHAR(20) NULL
);

CREATE TABLE TB_EXTRAS(
EXT_ID INT AUTO_INCREMENT PRIMARY KEY,
EXT_NOM VARCHAR(120) NOT NULL,
EXT_EST CHAR(1) DEFAULT '1' NOT NULL,
EXT_IMG BLOB NULL
);


CREATE TABLE TB_PRODUCTO(
PRO_ID INT AUTO_INCREMENT PRIMARY KEY,
PRO_NOM VARCHAR(120) NOT NULL,
PRO_DES VARCHAR(160) NOT NULL,
PRO_EST CHAR(1) DEFAULT '1' NOT NULL,
PRO_IMG BLOB NULL,
CAT_PRO_ID INT NOT NULL,
AUD_TIPO CHAR(1) NULL,
AUD_IDUSUARIO INT NULL,
AUD_SESION VARCHAR(60) NULL,
AUD_FECHA DATE NULL,
AUD_IP VARCHAR(20) NULL,
FOREIGN KEY (CAT_PRO_ID) REFERENCES TB_CATEGORIA_PRODUCTO(CAT_PRO_ID)
);

CREATE TABLE TB_USUARIO(
USU_ID INT AUTO_INCREMENT PRIMARY KEY,
USU_NOM VARCHAR(120)NOT NULL,
USU_APE VARCHAR(240) NOT NULL,
USU_USU VARCHAR(120) NOT NULL,
USU_PWD VARCHAR(220) NOT NULL,
TIP_DOC_ID INT NOT NULL,
USU_DOC_NUM INT NOT NULL,
ROL_ID INT NOT NULL,
USU_FEC_CON DATE NOT NULL,
USU_IMG BLOB NULL,
USU_EST CHAR(1) DEFAULT '1',
AUD_TIPO CHAR(1) NULL,
AUD_IDUSUARIO INT NULL,
AUD_SESION VARCHAR(60) NULL,
AUD_FECHA DATE NULL,
AUD_IP VARCHAR(20) NULL,
FOREIGN KEY (TIP_DOC_ID) REFERENCES TB_TIPO_DOCUMENTO(TIP_DOC_ID),
FOREIGN KEY (ROL_ID) REFERENCES TB_ROL(ROL_ID)
);


CREATE TABLE TB_DOCUMENTO_COMPRA(
DOC_COM_ID INT AUTO_INCREMENT PRIMARY KEY,
USU_ID INT NOT NULL,
PROV_ID INT NOT NULL,
DOC_COM_FEC DATE NOT NULL,
DOC_COM_EST CHAR(1) DEFAULT '1',
AUD_TIPO CHAR(1) NULL,
AUD_IDUSUARIO INT NULL,
AUD_SESION VARCHAR(60) NULL,
AUD_FECHA DATE NULL,
AUD_IP VARCHAR(20) NULL,
FOREIGN KEY (USU_ID) REFERENCES TB_USUARIO(USU_ID),
FOREIGN KEY (PROV_ID) REFERENCES TB_PROVEEDOR(PROV_ID)
);

CREATE TABLE TB_DETALLE_DE_DOCUMENTO_COMPRA(
DET_DOC_COM_ID INT AUTO_INCREMENT PRIMARY KEY,
DOC_COM_ID INT NOT NULL,
INS_ID INT NOT NULL,
DET_DOC_COM_PRE NUMERIC(8,2),
DET_DOC_COM_CAN INT NOT NULL,
IGV NUMERIC(3,2) DEFAULT 0.18,
DET_DOC_COM_NETO NUMERIC(8,2),
FOREIGN KEY (INS_ID) REFERENCES TB_INSUMO(INS_ID),
FOREIGN KEY (DOC_COM_ID) REFERENCES TB_DOCUMENTO_COMPRA(DOC_COM_ID)
);

CREATE TABLE TB_DOCUMENTO_DE_VENTA(
DOC_VEN_ID INT AUTO_INCREMENT PRIMARY KEY,
CLI_ID INT NOT NULL,
USU_ID INT NOT NULL,
DOC_VEN_FEC DATE NOT NULL,
DOC_VEN_TOT NUMERIC(8,2)NOT NULL,
DOC_VEN_EST CHAR(1) DEFAULT '1',
AUD_TIPO CHAR(1) NULL,
AUD_IDUSUARIO INT NULL,
AUD_SESION VARCHAR(60) NULL,
AUD_FECHA DATE NULL,
AUD_IP VARCHAR(20) NULL,
FOREIGN KEY (USU_ID) REFERENCES TB_USUARIO(USU_ID),
FOREIGN KEY (CLI_ID) REFERENCES TB_CLIENTE(CLI_ID)
); 

CREATE TABLE TB_DETALLE_DE_DOCUMENTO_VENTA(
DET_DOC_VEN_ID INT AUTO_INCREMENT PRIMARY KEY,
DOC_VEN_ID INT NOT NULL,
PRO_ID INT NOT NULL,
DET_DOC_VEN_PRE NUMERIC(8,2),
DET_DOC_VEN_CAN INT NOT NULL,
IGV NUMERIC(3,2) DEFAULT 0.18,
DET_DOC_VEN_NETO NUMERIC(8,2),
FOREIGN KEY (PRO_ID) REFERENCES TB_PRODUCTO(PRO_ID),
FOREIGN KEY (DOC_VEN_ID) REFERENCES TB_DOCUMENTO_DE_VENTA(DOC_VEN_ID)
);

CREATE TABLE TB_DETALLE_DE_EXTRAS(
  DET_EXT_ID INT AUTO_INCREMENT PRIMARY KEY,
  EXT_ID INT NOT NULL,
  DET_DOC_VEN_ID INT NOT NULL,
  EXT_PRE DECIMAL(8,2) NOT NULL,
  EXT_PAG INT NOT NULL DEFAULT 1,
  FOREIGN KEY (EXT_ID) REFERENCES TB_EXTRAS(EXT_ID),
  FOREIGN KEY (DET_DOC_VEN_ID) REFERENCES TB_DETALLE_DE_DOCUMENTO_VENTA(DET_DOC_VEN_ID)
);

